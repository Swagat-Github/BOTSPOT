$(function(){function t(){var i,n,s,o="",a=!1,d=JFCustomWidget.getWidgetSettings();function r(t,e){$(".sigPad .sigWrapper").width(t-2).height(e);t=4<t?t-4:50,e=4<e?e-4:50;$(".pad").attr({width:t,height:e})}function u(t){var e="#ccc";document.querySelector('body[data-theme="upcoming"]')&&d.ndt&&"1"===d.ndt&&(e="transparent"),i=$("#smoothed-variableStrokeWidth").signaturePad({validateFields:!1,drawOnly:!0,drawBezierCurves:!1,variableStrokeWidth:!0,lineTop:t-50,onDrawEnd:g,onFormError:$.noop,bgColour:"transparent",lineColour:e})}function e(t){o=t,JFCustomWidget.sendData({value:o})}function g(){var t;5<this.getSignature().length?(t=this.getSignatureImage(),8===JFCustomWidgetUtils.getIE()?setTimeout(function(){e(t)},500):e(t)):this.clearCanvas()}function h(t,e){var i={};i.width=(t||$(".sigWrapper").width())+10,i.height=(e||$(".sigWrapper").height())+20,a&&(n||s)&&(i.height+=30),JFCustomWidget.requestFrameResize(i)}this.init=function(t){n=t.themeVersion&&"v2"===t.themeVersion,s=t.isExtendedTheme,t.value?(a=!0,function(t){{var e;e=(0<=(o=t).indexOf("data:image/png;base64",0)?$("<img/>",{src:t}).load(function(){$(".sigNavImage").show(),JFCustomWidget.sendData({value:t}),setTimeout(function(){r($(this).width(),$(this).height()),h()},100)}):$("<img/>",{src:JFCustomWidgetUtils.getFormDomain()+t+"?"+(new Date).getTime(),crossOrigin:"anonymous"}).load(function(){var t=document.createElement("canvas"),e=t.getContext("2d"),e=(t.height=this.naturalHeight,t.width=this.naturalWidth,e.drawImage(this,0,0),t.toDataURL());JFCustomWidget.sendData({value:e}),$(".sigNavImage").show(),setTimeout(function(){r($(this).width(),$(this).height()),h()},100)})).insertBefore(".sigNavImage").css("border","1px solid #ccc")}$(".clearImage").click(function(){a=!1,u(e.height()),$(".sigPad img").remove(),$(".sigNavImage").hide()})}(t.value)):function(t){{var e;t=JFCustomWidget.isFromCardform()?(e=$("body").outerWidth(),$("body").outerHeight()):(e=window.innerWidth<t.width?window.innerWidth-10:t.width,t.height)}r(e,t),u(t),h(e,t)}(t);$(".clearButton").click(function(){o="",JFCustomWidget.sendData({value:""})})},this.getData=function(){var t={valid:a?!!o:i.validateForm(),value:o};t.valid||(t.value="");return t},this.resizeFrame=h,this.rebuildPad=function(t,e){r(t,e),u(e),h(),i.clearCanvas(),$(".sigWrapper").show(),$(".sigNav").show()}}JFCustomWidget.subscribe("ready",function(i){var n=new t;n.init(i),JFCustomWidget.subscribe("submit",function(){JFCustomWidget.sendSubmit(n.getData())}),JFCustomWidget.isFromCardform()?JFCustomWidget.subscribe("show",function(){var t=$("body").outerWidth(),e=i.height;0==i.viewHeight&&($(".sigPad .sigWrapper").width()+4<t||$(".sigPad .sigWrapper").height()<e-20)&&n.rebuildPad(t,i.height)}):/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&JFCustomWidget.detectFrameMovement(function(t){"absolute"===$(".sigPad")[0].style.position?$(".sigPad")[0].style.position="relative":$(".sigPad")[0].style.position="absolute"}),JFCustomWidget.subscribe("cardform:widgetcss:active",function(){"executeUntil"in JFCustomWidgetUtils&&JFCustomWidgetUtils.executeUntil(3e3,function(){n.resizeFrame()})}),function(){function e(t){t.classList.remove("signature-placeholder"),this.removeEventListener("mousedown",e),this.removeEventListener("pointerdown",e)}function t(t){setTimeout(function(){a.value||t.classList.add("signature-placeholder")},0)}var i=document.querySelector(".pad"),n=document.querySelector(".sigWrapper"),s=document.querySelector(".clearButton"),o=JFCustomWidget.getWidgetSettings(),a=document.querySelector(".output");i.addEventListener("mouseleave",function(){$(this).mouseup()}),o&&"1"===o.ndt&&(i.addEventListener("mousedown",e.bind(this,n)),i.addEventListener("pointerdown",e.bind(this,n)),i.addEventListener("mouseup",t.bind(this,n)),i.addEventListener("pointerup",t.bind(this,n)),s.addEventListener("click",function(){n.classList.add("signature-placeholder"),i.addEventListener("mousedown",e.bind(this,n)),i.addEventListener("pointerdown",e.bind(this,n))}))}()})});